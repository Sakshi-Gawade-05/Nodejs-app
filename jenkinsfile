pipeline {
    agent any
    
    environment {
    DOCKER_REGISTRY = "sakshigawade"
        IMAGE_NAME = "nodejs-app"
    }
    
stages {
    stage('Checkout code') {
        steps {
           git branch: 'main', url: 'https://github.com/Sakshi-Gawade-05/Nodejs-app.git'
        }
    }

    stage('Build Docker Image') {
        steps {
             script {
                 sh "docker build -t ${DOCKER_REGISTRY}/${IMAGE_NAME}:latest ."
              }
            }
        }
        stage('Push Docker Image') {
            steps {
                 script {
                  sh "docker push ${DOCKER_REGISTRY}/${IMAGE_NAME}:latest"
               }         
            }
         }  
        stage('Deploy to kubernetes') {
            steps {
                script {
                  sh """
                  kubectl apply -f deployment.yml
                  kubectl apply -f service.yml
                  """
        }
    }
  } 
}
post {
    success {
      echo "Deployment successful"
      }
    failure {
      echo "Deployment failed"
    }
  }
 }
